<h2>Add a Location</h2>

<% if flash[:alert] %>
  <div style="color: red; margin-bottom: 1rem;">
    <%= flash[:alert] %>
  </div>
<% end %>

<%= form_with url: locations_path, method: :post, local: true do |form| %>
  <div>
    <%= form.label :address, "Enter Street Address, Zipcode, or IP Address" %>
    <%= form.text_field :address, placeholder: "street city state zipcode, or zipcode, or x.x.x.x", size: 40 %>
  </div>
  <%= form.submit "Get Forecast" %>
<% end %>

<h1>Your Locations and Forecasts</h1>

<% if @locations.any? %>
  <% @locations.each do |location| %>
    <div>
      <h2><%= location.title %></h2>
      <% if @forecasts[location.id] %>
        <ul>
          <% @forecasts[location.id]["time"].each_with_index do |date, index| %>
            <li>
              <strong><%= date %></strong>:
              High: <%= @forecasts[location.id]["temperature_2m_max"][index] %>°F,
              Low: <%= @forecasts[location.id]["temperature_2m_min"][index] %>°F
            </li>
          <% end %>
        </ul>
        <%= button_to "Edit", edit_location_path(location), method: :get %>
        <%= form_with model: location, url: location_path(location), method: :delete, local: true do %>
          <%= submit_tag "Delete" %>
        <% end %>
      <% else %>
        <p>Unable to retrieve forecast data for this location.</p>
      <% end %>
    </div>
  <% end %>
<% else %>
  <p>No locations found.</p>
<% end %>
